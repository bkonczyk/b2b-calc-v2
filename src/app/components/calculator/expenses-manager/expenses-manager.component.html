<div class="bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 p-6 shadow-sm dark:shadow-none transition-colors duration-300">
    <div class="flex justify-between items-center mb-6">
        <h3 class="text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest flex items-center gap-2">
            <span class="w-1.5 h-1.5 bg-orange-500 rounded-full"></span>
            Rejestr Kosztów
        </h3>
        <button
                (click)="service.addExpense()"
                class="bg-slate-800 hover:bg-emerald-600 dark:bg-slate-700 dark:hover:bg-emerald-600 text-white text-xs font-bold uppercase tracking-wider py-2 px-4 rounded transition-all flex items-center gap-2"
        >
            <span>+ Dodaj</span>
        </button>
    </div>

    <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
            <thead>
            <tr class="text-slate-500 dark:text-slate-500 text-xs font-mono uppercase border-b border-slate-200 dark:border-slate-700">
                <th class="pb-3 px-2 font-normal">Opis transakcji</th>
                <th class="pb-3 px-2 font-normal w-32">Netto</th>
                <th class="pb-3 px-2 font-normal w-24">VAT</th>
                <th class="pb-3 px-2 text-center w-16">Opcje</th>
                <th class="pb-3 px-2 text-right w-16"></th>
            </tr>
            </thead>
            <tbody class="divide-y divide-slate-200 dark:divide-slate-700/50">
                @for (expense of service.expenses(); track expense.id) {
                    <tr class="group hover:bg-slate-50 dark:hover:bg-slate-700/20 transition-colors">
                        <td class="py-3 px-2">
                            <input
                                    type="text"
                                    [value]="expense.name"
                                    (input)="service.updateExpense(expense.id, 'name', getVal($event))"
                                    class="bg-transparent border-b border-transparent focus:border-emerald-500 text-slate-800 dark:text-slate-200 text-sm w-full outline-none py-1 placeholder-slate-500 dark:placeholder-slate-600"
                                    placeholder="Nazwa kosztu"
                            />
                        </td>
                        <td class="py-3 px-2">
                            <div class="relative">
                                <input
                                        type="number"
                                        [value]="expense.net"
                                        (input)="service.updateExpense(expense.id, 'net', getNum($event))"
                                        class="bg-slate-100 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 focus:border-emerald-500 rounded px-2 py-1 text-right text-slate-800 dark:text-slate-200 font-mono text-sm w-full outline-none"
                                />
                            </div>
                        </td>
                        <td class="py-3 px-2">
                            <select
                                    (change)="service.updateExpense(expense.id, 'vat', getNum($event))"
                                    class="bg-slate-100 dark:bg-slate-900/50 border border-slate-200 dark:border-slate-700 rounded px-1 py-1 text-slate-800 dark:text-slate-300 text-xs w-full outline-none focus:border-emerald-500"
                            >
                                <option [value]="23" [selected]="expense.vat == 23">23%</option>
                                <option [value]="8" [selected]="expense.vat == 8">8%</option>
                                <option [value]="0" [selected]="expense.vat == 0">0%</option>
                            </select>
                        </td>
                        <td class="py-3 px-2 text-center">
                            <button
                                    (click)="toggleCarType(expense.id, expense.carType)"
                                    class="p-1.5 rounded transition-all relative group/tooltip"
                                    [ngClass]="{
                                    'text-slate-400 hover:text-slate-600 dark:hover:text-slate-200': !expense.carType || expense.carType === 'none',
                                    'text-blue-500 bg-blue-100 dark:bg-blue-900/30': expense.carType === 'mixed',
                                    'text-orange-500 bg-orange-100 dark:bg-orange-900/30': expense.carType === 'private'
                                }"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2" />
                                    <circle cx="7" cy="17" r="2" />
                                    <circle cx="17" cy="17" r="2" />
                                </svg>

                                <!-- Tooltip -->
                                <div class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-slate-800 text-white text-[10px] rounded opacity-0 group-hover/tooltip:opacity-100 pointer-events-none whitespace-nowrap z-10 transition-opacity">
                                    {{ getCarTooltip(expense.carType) }}
                                </div>
                            </button>
                        </td>
                        <td class="py-3 px-2 text-right">
                            <button
                                    (click)="service.removeExpense(expense.id)"
                                    class="text-slate-400 dark:text-slate-600 hover:text-rose-500 transition-colors"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                     fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                     stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        @if (service.expenses().length === 0) {
            <div class="text-center py-8 text-slate-500 dark:text-slate-600 text-xs font-mono">
                BRAK WPISÓW W REJESTRZE KOSZTÓW
            </div>
        }
    </div>
</div>
